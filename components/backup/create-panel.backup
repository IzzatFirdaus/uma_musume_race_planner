<!-- components/create-panel.php -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-uma text-white">
    <span class="fw-bold">Create New Plan</span>
  </div>
  <div class="card-body">
    <form id="quickPlanForm" novalidate>
      <input type="hidden" name="status" value="Planning" />

      <div class="mb-3">
        <label for="planTitle" class="form-label">Plan Title</label>
        <input type="text" class="form-control" id="planTitle" name="plan_title" placeholder="Auto-generated from inputs" required readonly />
      </div>

      <div class="mb-3">
        <label for="traineeName" class="form-label">Trainee Name</label>
        <input type="text" class="form-control autosuggest" id="traineeName" name="name" placeholder="[Title] Name" data-type="name" list="nameSuggestions" required />
        <datalist id="nameSuggestions"></datalist>
      </div>

      <div class="mb-3">
        <label for="careerStage" class="form-label">Career Stage</label>
        <select class="form-select" id="careerStage" name="career_stage" required>
          <option value="predebut">Pre-Debut</option>
          <option value="junior" selected>Junior Year</option>
          <option value="classic">Classic Year</option>
          <option value="senior">Senior Year</option>
          <option value="finale">Finale Season</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="traineeClass" class="form-label">Class</label>
        <select class="form-select" id="traineeClass" name="class" required>
          <option value="debut">Debut</option>
          <option value="maiden">Maiden</option>
          <option value="beginner" selected>Beginner</option>
          <option value="bronze">Bronze</option>
          <option value="silver">Silver</option>
          <option value="gold">Gold</option>
          <option value="platinum">Platinum</option>
          <option value="star">Star</option>
          <option value="legend">Legend</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="strategy" class="form-label">Strategy</label>
        <select class="form-select" id="strategy" name="strategy_id" required>
          <option value="">Select...</option>
          <?php
          $strategies = $pdo->query("SELECT id, label FROM strategies ORDER BY label ASC")->fetchAll();
          foreach ($strategies as $s) {
              echo "<option value=\"{$s['id']}\">{$s['label']}</option>";
          }
          ?>
        </select>
      </div>

      <div class="mb-3">
        <label for="raceName" class="form-label">Race Name</label>
        <input type="text" class="form-control autosuggest" id="raceName" name="race_name" placeholder="e.g. URA Finale Qualifier" data-type="race_name" list="raceNameSuggestions" required />
        <datalist id="raceNameSuggestions"></datalist>
      </div>

      <div class="mb-3">
        <label for="turnBefore" class="form-label">Turns Before Race</label>
        <input type="number" class="form-control" id="turnBefore" name="turn_before" min="0" max="99" value="0" required />
      </div>

      <div class="mb-3">
        <label for="month" class="form-label">Month</label>
        <select class="form-select" id="month" name="month" required>
          <?php foreach (range(1, 12) as $m): ?>
            <option value="<?= $m ?>"><?= date("F", mktime(0, 0, 0, $m)) ?></option>
          <?php endforeach; ?>
        </select>
      </div>

      <div class="mb-3">
        <label for="sp" class="form-label">Total Available SP</label>
        <input type="number" class="form-control" id="sp" name="total_available_skill_points" min="0" max="9999" />
      </div>

      <div class="mb-3">
        <label for="acquireSkill" class="form-label">Acquired Skill</label>
        <select class="form-select" id="acquireSkill" name="acquire_skill">
          <option value="NO" selected>No</option>
          <option value="YES">Yes</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="mood" class="form-label">Mood</label>
        <select class="form-select" id="mood" name="mood_id">
          <?php
          $moods = $pdo->query("SELECT id, label FROM moods ORDER BY FIELD(label, 'GREAT','GOOD','NORMAL','BAD','AWFUL')")->fetchAll();
          foreach ($moods as $m) {
              $selected = $m['label'] === 'NORMAL' ? 'selected' : '';
              echo "<option value=\"{$m['id']}\" $selected>{$m['label']}</option>";
          }
          ?>
        </select>
      </div>

      <div class="mb-3">
        <label for="condition" class="form-label">Condition</label>
        <select class="form-select" id="condition" name="condition_id">
          <option value="">(Optional)</option>
          <?php
          $conditions = $pdo->query("SELECT id, label FROM conditions ORDER BY label ASC")->fetchAll();
          foreach ($conditions as $c) {
              echo "<option value=\"{$c['id']}\">{$c['label']}</option>";
          }
          ?>
        </select>
      </div>

      <div class="mb-3">
        <label for="energy" class="form-label">Energy</label>
        <div class="d-flex align-items-center">
          <input type="range" class="form-range me-3" id="energy" name="energy" min="0" max="100" step="1" value="100" oninput="document.getElementById('energyValue').value = this.value" />
          <input type="number" class="form-control" id="energyValue" value="100" min="0" max="100" style="width: 70px;" onchange="document.getElementById('energy').value = this.value" />
        </div>
      </div>

      <div class="mb-3">
        <label for="goal" class="form-label">Goal</label>
        <input type="text" class="form-control" id="goal" name="goal" placeholder="e.g. Win URA Final" />
      </div>

      <button type="submit" class="btn btn-uma w-100">
        <i class="bi bi-plus-circle me-1"></i> Create Plan
      </button>
    </form>
  </div>
</div>

<script>
  const nameEl = document.getElementById("traineeName");
  const raceEl = document.getElementById("raceName");
  const monthEl = document.getElementById("month");
  const titleEl = document.getElementById("planTitle");

  const updateTitle = () => {
    const name = nameEl.value.trim();
    const race = raceEl.value.trim();
    const month = monthEl.options[monthEl.selectedIndex]?.text ?? "";
    titleEl.value = name && race ? `${month} ${race} (${name})` : "";
  };

  [nameEl, raceEl, monthEl].forEach(el => el?.addEventListener("input", updateTitle));
</script>
